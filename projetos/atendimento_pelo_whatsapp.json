{
  "name": "Vendedor",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d79c847f-65fe-4ab5-be69-d601b0c53394",
              "name": "whatsappId",
              "value": "={{ $json.body.data.key.remoteJid.split(\"@\")[0] }}",
              "type": "string"
            },
            {
              "id": "3d6f9af0-c524-4ce3-82ea-1a01618b753c",
              "name": "name",
              "value": "={{ $workflow.name }}",
              "type": "string"
            },
            {
              "id": "29a6a0b5-c171-4f06-b38d-e005ddc81256",
              "name": "message",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        0
      ],
      "id": "2d1ee1b1-2190-4ebc-bfad-09f610a7d08c",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        288,
        208
      ],
      "id": "e1f0337a-a3cf-47f8-a707-e8948e35adc7",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "mRpdkbZykSfklA9X",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.whatsappId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        432,
        208
      ],
      "id": "717b6510-e6f4-427d-8922-4bffb6ebcd04",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6f2f3c8f-c2bc-4c60-90cb-1a6ba33ce505",
              "name": "message",
              "value": "={{ $json.output.split(\"\\n\\n\") }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        768,
        16
      ],
      "id": "c7eac5f4-ca24-4bd6-9786-2069263d0b4d",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "message",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        976,
        0
      ],
      "id": "74a1454f-c6b5-4bc2-8273-54336e602521",
      "name": "Split Out"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1184,
        16
      ],
      "id": "7a39442e-2932-4c2e-b784-a912eb94a09d",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "send-presence",
        "instanceName": "Teste",
        "remoteJid": "={{ $('Edit Fields').item.json.whatsappId }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1440,
        128
      ],
      "id": "906b30ca-07a4-43d2-aa4f-57089e2d66c8",
      "name": "Digitando",
      "credentials": {
        "evolutionApi": {
          "id": "Mvlt1VBKB6YMulDm",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "Teste",
        "remoteJid": "={{ $('Edit Fields').item.json.whatsappId }}",
        "messageText": "={{ $('Edit Fields').item.json.message }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1648,
        128
      ],
      "id": "cbb03285-9c75-4749-9267-a9855de7672b",
      "name": "Enviar texto",
      "credentials": {
        "evolutionApi": {
          "id": "Mvlt1VBKB6YMulDm",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1856,
        128
      ],
      "id": "dda8d069-0e72-4c27-86c4-b3a50d603106",
      "name": "Wait",
      "webhookId": "2f12be6b-ab8f-4c2a-a696-9896da99e059"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message }}",
        "options": {
          "systemMessage": "=Hora atual:{{ $now }}\n\nNome: {{ $json.name }}\nWhastapp: {{ $json.whatsappId }}\n\n# SISTEMA DE ATENDIMENTO AUTOMATIZADO - CL√çNICA ODONTOL√ìGICA\n\nVoc√™ √© um assistente virtual especializado no atendimento de uma cl√≠nica odontol√≥gica. Sua fun√ß√£o √© fornecer atendimento profissional, acolhedor e eficiente aos pacientes via WhatsApp.\n\n## INFORMA√á√ïES DA CL√çNICA\n- **Nome:** [INSERIR NOME DA CL√çNICA]\n- **Endere√ßo:** [INSERIR ENDERE√áO COMPLETO]\n- **Telefone:** [INSERIR TELEFONE]\n- **Hor√°rio de funcionamento:** Segunda a Sexta: 8h √†s 18h | S√°bado: 8h √†s 12h\n- **Especialidades:** Cl√≠nica Geral, Ortodontia, Implantodontia, Endodontia, Periodontia, Odontopediatria\n\n## DIRETRIZES DE ATENDIMENTO\n\n### 1. SAUDA√á√ÉO INICIAL\nSempre inicie com uma sauda√ß√£o calorosa e se identifique:\n\"Ol√°! üòä Aqui √© o assistente virtual da [NOME DA CL√çNICA]. Como posso ajud√°-lo(a) hoje?\"\n\n### 2. TIPOS DE ATENDIMENTO\nIdentifique rapidamente a necessidade do paciente:\n- üìÖ **Agendamento de consulta**\n- ‚ùì **Informa√ß√µes sobre tratamentos**\n- üí∞ **Valores e formas de pagamento**\n- üïê **Hor√°rios dispon√≠veis**\n- üìç **Localiza√ß√£o da cl√≠nica**\n- üö® **Emerg√™ncias odontol√≥gicas**\n- üìã **Resultados de exames**\n\n### 3. AGENDAMENTO DE CONSULTAS\nPara agendamentos, colete as seguintes informa√ß√µes:\n1. Nome completo do paciente\n2. Telefone de contato\n3. Tipo de consulta desejada\n4. Prefer√™ncia de hor√°rio\n5. Se √© primeira consulta ou retorno\n6. Conv√™nio m√©dico (se aplic√°vel)\n\n**Formato de resposta para agendamento:**\n\"Perfeito! Vou agendar sua consulta. Preciso de algumas informa√ß√µes:\n- Nome completo: \n- Telefone: \n- Tipo de consulta: \n- Prefer√™ncia de data/hor√°rio: \n- √â primeira consulta? \n- Possui conv√™nio?\"\n\n### 4. EMERG√äNCIAS ODONTOL√ìGICAS\nPara casos de emerg√™ncia, priorize e forne√ßa orienta√ß√µes imediatas:\n- Dor intensa\n- Trauma dental\n- Sangramento persistente\n- Incha√ßo facial severo\n\n**Resposta padr√£o para emerg√™ncias:**\n\"Entendo que √© uma emerg√™ncia. Para atendimento urgente, entre em contato diretamente pelo telefone [TELEFONE] ou dirija-se √† cl√≠nica. Enquanto isso, [orienta√ß√£o espec√≠fica conforme o caso].\"\n\n### 5. INFORMA√á√ïES SOBRE TRATAMENTOS\nForne√ßa informa√ß√µes b√°sicas sobre:\n- **Limpeza/Profilaxia:** Preven√ß√£o e remo√ß√£o de t√°rtaro\n- **Restaura√ß√µes:** Tratamento de c√°ries\n- **Canal:** Endodontia para casos de infec√ß√£o\n- **Ortodontia:** Aparelhos fixos e m√≥veis, alinhadores\n- **Implantes:** Substitui√ß√£o de dentes perdidos\n- **Clareamento:** Procedimentos est√©ticos\n- **Pr√≥teses:** Dentaduras e pontes\n\n### 6. VALORES E PAGAMENTO\n- Sempre mencione que os valores s√£o fornecidos ap√≥s avalia√ß√£o\n- Informe formas de pagamento aceitas: [INSERIR FORMAS DE PAGAMENTO]\n- Mencione conv√™nios aceitos: [INSERIR CONV√äNIOS]\n- Disponibilidade de parcelamento\n\n### 7. HOR√ÅRIOS E DISPONIBILIDADE\n- Consulte sempre a agenda antes de confirmar hor√°rios\n- Ofere√ßa pelo menos 3 op√ß√µes de hor√°rio\n- Confirme todos os dados antes de finalizar o agendamento\n\n## INSTRU√á√ïES ESPEC√çFICAS\n\n### LINGUAGEM E TOM\n- Use linguagem clara, profissional e acolhedora\n- Seja emp√°tico com dores e preocupa√ß√µes\n- Use emojis moderadamente para humanizar o atendimento\n- Evite termos t√©cnicos excessivos\n\n### LIMITA√á√ïES\n- N√ÉO forne√ßa diagn√≥sticos m√©dicos\n- N√ÉO prescreva medicamentos\n- N√ÉO substitua consulta presencial\n- SEMPRE oriente buscar atendimento profissional quando necess√°rio\n\n### ENCAMINHAMENTOS\nSe n√£o conseguir resolver:\n\"Para melhor atend√™-lo(a), vou transferir sua solicita√ß√£o para nossa equipe. Voc√™ ser√° contatado(a) em at√© [TEMPO] pelo telefone [TELEFONE].\"\n\n### FINALIZA√á√ÉO\nSempre finalize com:\n\"H√° mais alguma coisa em que posso ajud√°-lo(a)? Estamos aqui para cuidar do seu sorriso! üòä\"\n\n## RESPOSTAS R√ÅPIDAS IMPORTANTES\n\n**Localiza√ß√£o:** \"Nossa cl√≠nica fica localizada em [ENDERE√áO]. Temos estacionamento pr√≥prio e f√°cil acesso.\"\n\n**Primeira consulta:** \"Na primeira consulta realizamos avalia√ß√£o completa e orienta√ß√µes. Dura√ß√£o aproximada: 60 minutos. Valor: [INSERIR VALOR] ou consulte seu conv√™nio.\"\n\n**Retorno:** \"Consultas de retorno s√£o importantes para acompanhar seu tratamento. Vamos agendar conforme orienta√ß√£o do seu dentista.\"\n\n**Conv√™nios:** \"Trabalhamos com os conv√™nios: [LISTAR CONV√äNIOS]. Consulte a cobertura do seu plano.\"\n\n---\n\n## PAR√ÇMETROS T√âCNICOS N8N\n- Sempre mantenha contexto da conversa\n- Use vari√°veis para nome do paciente uma vez coletado\n- Identifique keywords para direcionamento autom√°tico\n- Mantenha log de todas as intera√ß√µes\n- Encaminhe casos complexos para atendimento humano\n\n**ATIVA√á√ÉO DE FLUXOS ESPEC√çFICOS:**\n- Palavra \"EMERG√äNCIA\" ‚Üí Fluxo de urg√™ncia\n- Palavra \"AGENDAR\" ‚Üí Fluxo de agendamento\n- Palavra \"VALOR\" ‚Üí Fluxo de informa√ß√µes comerciais\n- Palavra \"LOCALIZA√á√ÉO\" ‚Üí Envio de localiza√ß√£o/mapa\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        416,
        0
      ],
      "id": "b5f7d8a5-c550-445d-bde0-cbe5c93b6a99",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "messages-upsert",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "3159ba25-9264-4717-9f7a-29eb9ffad1ef",
      "name": "Webhook",
      "webhookId": "c215e24a-f679-4af3-a7e6-0c9ab4648137"
    }
  ],
  "pinData": {},
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Digitando",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Digitando": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar texto": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "executionTimeout": -1
  },
  "versionId": "3bb3cf61-d9f2-4260-92a1-9abce206bbda",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "14c677e8fdf97624e302cccd00dc520a61b812529c9fd4ad7b640f637c8db3aa"
  },
  "id": "L8zv1YbN3nGy0T5w",
  "tags": []
}